<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>noir.util.middleware documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Lib-noir 0.9.0 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>noir</span></div></div></li><li class="depth-2 branch"><a href="noir.cookies.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cookies</span></div></a></li><li class="depth-2 branch"><a href="noir.io.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>io</span></div></a></li><li class="depth-2 branch"><a href="noir.request.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>request</span></div></a></li><li class="depth-2 branch"><a href="noir.response.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>response</span></div></a></li><li class="depth-2 branch"><a href="noir.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-3 branch"><a href="noir.util.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-3 branch"><a href="noir.util.crypt.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>crypt</span></div></a></li><li class="depth-3 branch current"><a href="noir.util.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="noir.util.route.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>route</span></div></a></li><li class="depth-3"><a href="noir.util.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2"><a href="noir.validation.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>validation</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="noir.util.middleware.html#var-app-handler"><div class="inner"><span>app-handler</span></div></a></li><li class="depth-1"><a href="noir.util.middleware.html#var-wrap-access-rules"><div class="inner"><span>wrap-access-rules</span></div></a></li><li class="depth-1"><a href="noir.util.middleware.html#var-wrap-canonical-host"><div class="inner"><span>wrap-canonical-host</span></div></a></li><li class="depth-1"><a href="noir.util.middleware.html#var-wrap-force-ssl"><div class="inner"><span>wrap-force-ssl</span></div></a></li><li class="depth-1"><a href="noir.util.middleware.html#var-wrap-if"><div class="inner"><span>wrap-if</span></div></a></li><li class="depth-1"><a href="noir.util.middleware.html#var-wrap-request-map"><div class="inner"><span>wrap-request-map</span></div></a></li><li class="depth-1"><a href="noir.util.middleware.html#var-wrap-rewrites"><div class="inner"><span>wrap-rewrites</span></div></a></li><li class="depth-1"><a href="noir.util.middleware.html#var-wrap-strip-trailing-slash"><div class="inner"><span>wrap-strip-trailing-slash</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">noir.util.middleware</h2><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-app-handler"><h3>app-handler</h3><div class="usage"><code>(app-handler app-routes &amp; {:keys [session-options store multipart middleware access-rules formats ring-defaults]})</code></div><div class="doc"><pre class="plaintext">creates the handler for the application and wraps it in base middleware:
- wrap-request-map
- site-defaults
- wrap-multipart-params
- wrap-noir-validation
- wrap-noir-cookies
- wrap-noir-flash
- wrap-noir-session

:session-options - optional map specifying Ring session parameters, eg: {:cookie-attrs {:max-age 1000}}
:store           - deprecated: use sesion-options instead!
:multipart       - an optional map of multipart-params middleware options
:middleware      - a vector of any custom middleware wrappers you wish to supply
:ring-defaults   - pass in optional map for initializing ring-defaults, uses site-defaults if none passed
                   see <a href="https://github.com/ring-clojure/ring-defaults">https://github.com/ring-clojure/ring-defaults</a>
                   for more details
:formats         - optional vector containing formats that should be serialized and
                   deserialized, eg:

                   :formats [:json-kw :transit-json :edn]

                available formats:
                :json - JSON with string keys in :params and :body-params
                :json-kw - JSON with keywodized keys in :params and :body-params
                :yaml - YAML format
                :yaml-kw - YAML format with keywodized keys in :params and :body-params
                :edn - Clojure format
                :yaml-in-html - yaml in a html page (useful for browser debugging)
                :transit-json Transit over JSON format
                :transit-msgpack Transit over Msgpack format

:access-rules - a vector of access rules you wish to supply,
                each rule should a function or a rule map as specified in wrap-access-rules, eg:

                :access-rules [rule1
                               rule2
                               {:redirect &quot;/unauthorized1&quot;
                                :rules [rule3 rule4]}]</pre></div></div><div class="public anchor" id="var-wrap-access-rules"><h3>wrap-access-rules</h3><div class="usage"><code>(wrap-access-rules handler rules)</code></div><div class="doc"><pre class="plaintext">wraps the handler with the supplied access rules.

Use the noir.util.route/restricted macro to wrap any routes
that you wish the access rules to apply to, eg:

(GET &quot;/user/profile&quot; [] (restricted &quot;this route is private&quot;))

Each rule accepts the request and returns a boolean indicating whether it
passed or not, eg:

(defn user-access [req]
 (session/get :user))

(wrap-access-rules handler [user-access])

Each rule can either be a function or a map. When a rule is a function, then
it redirects to &quot;/&quot; and will be checked for each restricted route.

When specifying rules as a map you can provide further directives using the
following keys:

:uri - the URI pattern to which the rules apply (optional, defaults to any URI)
:uris - alternative to :uri, allows specifying a collection of URIs (optional)
:redirect - the redirect target for the rules (optional defaults to &quot;/&quot;)
:on-fail - alternative to redirect, allows specifying a handler function for
           handling the failure, the function must accept the request as a
           parameter (optional)
:rule - a single rule (either :rule or :rules is required)
:rules - alternative to rule, allows specifying a list of rules

The :rules can be specified in any of the following ways:

:rules [rule1 rule2]
:rules {:any [rule1 rule2]}
:rules {:every [rule1 rule2] :any [rule3 rule4]}

By default every rule has to pass, the :any key specifies that it&apos;s sufficient for
any of the rules to pass.

(defn admin-access [req]
 (session/get :admin))

(wrap-access-rules handler [{:redirect &quot;/access-denied&quot;
                             :rule user-access}])

(wrap-access-rules handler [{:uri &quot;/user/*&quot; :rule user-access}])

(wrap-access-rules handler [{:uri &quot;/admin/*&quot; :rule admin-access}
                            {:uri &quot;/user/*&quot;
                             :rules {:any [user-access admin-access]}])

(wrap-access-rules handler [{:on-fail (fn [req] &quot;access restricted&quot;)
                             :rule user-access}])
</pre></div></div><div class="public anchor" id="var-wrap-canonical-host"><h3>wrap-canonical-host</h3><div class="usage"><code>(wrap-canonical-host app canonical)</code></div><div class="doc"><pre class="plaintext">If the request is not targeting host canonical, redirect the
request to that host.</pre></div></div><div class="public anchor" id="var-wrap-force-ssl"><h3>wrap-force-ssl</h3><div class="usage"><code>(wrap-force-ssl app)</code></div><div class="doc"><pre class="plaintext">If the request&apos;s scheme is not https, redirect with https.
Also checks the X-Forwarded-Proto header.</pre></div></div><div class="public anchor" id="var-wrap-if"><h3>wrap-if</h3><div class="usage"><code>(wrap-if handler pred wrapper &amp; args)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-wrap-request-map"><h3>wrap-request-map</h3><div class="usage"><code>(wrap-request-map handler)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-wrap-rewrites"><h3>wrap-rewrites</h3><div class="usage"><code>(wrap-rewrites handler &amp; rewrites)</code></div><div class="doc"><pre class="plaintext">Rewrites should be [regex replacement] pairs. The first regex that matches the request&apos;s URI will
have the corresponding (global) replacement performed before calling the wrapped handler.</pre></div></div><div class="public anchor" id="var-wrap-strip-trailing-slash"><h3>wrap-strip-trailing-slash</h3><div class="usage"><code>(wrap-strip-trailing-slash handler)</code></div><div class="doc"><pre class="plaintext">If the requested url has a trailing slash, remove it.
</pre></div></div></div></body></html>